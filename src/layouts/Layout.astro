---
import { ClientRouter } from 'astro:transitions';

interface Props {
  title: string;
  description: string;
  image?: string;
}

const { title, description, image } = Astro.props;
const ogImage = image
  ? `https://baradusov.ru${image}`
  : 'https://baradusov.ru/hero.png';

const isIndex = Astro.url.pathname === '/';
const canonical = `https://baradusov.ru${Astro.url.pathname}`;
---

<!doctype html>
<html lang="ru">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width" />

    <title>{title}</title>
    <meta name="title" content={title} />
    <meta name="description" content={description} />

    <meta property="og:type" content="website" />
    <meta property="og:url" content={canonical} />
    <meta property="og:title" content={title} />
    <meta property="og:description" content={description} />
    <meta property="og:image" content={ogImage} />

    <meta
      name="twitter:card"
      content={ogImage ? 'summary_large_image' : 'summary'}
    />
    <meta property="twitter:url" content={canonical} />
    <meta property="twitter:title" content={title} />
    <meta property="twitter:description" content={description} />
    <meta name="twitter:image" content={ogImage} />

    <link
      rel="alternate"
      type="application/rss+xml"
      title="baradusov.ru"
      href="/feed.xml"
    />

    <ClientRouter />
  </head>
  <body>
    <header>
      {
        isIndex === false && (
          <a class="not-hero-link" href="/">
            <img
              class="not-hero"
              src="/hero.png"
              alt=""
              width="772"
              height="200"
            />
          </a>
        )
      }

      {
        isIndex && (
          <img class="hero" src="/hero.png" alt="" width="772" height="686" />
        )
      }
    </header>

    <slot />

    <footer>
      <p>
        Следить за обновлениями можно через <a href="/feed.xml">RSS</a> или <a
          href="https://t.me/nuril_notes">
          телеграм-канал
        </a>.
      </p>
    </footer>
  </body><style is:global>
    /* reset */
    *,
    *:before,
    *:after {
      box-sizing: inherit;
    }

    * {
      margin: 0;
    }

    html,
    body {
      box-sizing: border-box;
      -moz-text-size-adjust: none;
      -webkit-text-size-adjust: none;
      text-size-adjust: none;
    }

    p,
    h1,
    h2,
    h3,
    h4,
    h5,
    h6 {
      overflow-wrap: break-word;
    }

    a {
      display: inline-block;
    }

    ul {
      margin: 0;
      padding: 0;
      list-style: none;
    }

    pre {
      overflow-x: auto;
    }

    img,
    picture,
    video,
    canvas,
    svg {
      display: block;
      max-width: 100%;
      height: auto;
    }

    input,
    button,
    textarea,
    select {
      font: inherit;
    }

    /* global */
    @font-face {
      font-family: 'IBM Plex Sans';
      font-style: normal;
      font-weight: 400;
      src: url('/fonts/IBMPlexSans-Regular.woff2') format('woff2');
      font-display: swap;
    }

    @font-face {
      font-family: 'IBM Plex Sans';
      font-style: normal;
      font-weight: 700;
      src: url('/fonts/IBMPlexSans-Bold.woff2') format('woff2');
      font-display: swap;
    }

    body {
      max-width: 772px;
      margin: auto;
      padding-bottom: 32px;
      background-color: #fcfae3;
      font-family: 'IBM Plex Sans', sans-serif;
      font-size: 18px;
      line-height: 1.5;
    }

    header {
      padding-top: 16px;
      margin-bottom: 32px;
    }

    a {
      color: inherit;
      text-underline-position: under;
    }

    a:hover {
      text-decoration-line: none;
    }

    hr {
      width: 50px;
      margin: 30px auto;
      border: 1px solid black;
    }

    main {
      margin-bottom: 32px;
    }

    footer,
    main {
      padding-inline: 8px;
    }

    section {
      margin-bottom: 32px;
    }

    h1,
    h2 {
      margin-bottom: 16px;
    }

    h3 {
      margin-bottom: 8px;
    }

    h1,
    h2,
    h3,
    h4 {
      text-wrap: balance;
      line-height: 1.2;
    }

    li {
      margin-bottom: 8px;
    }

    .feed section {
      display: grid;
      grid-template-columns: repeat(8, 1fr);
    }

    @media (max-width: 600px) {
      .feed section {
        display: block;
      }
    }

    /* post page */
    :root {
      --gap: 14px;
    }

    .content {
      display: flex;
      flex-direction: column;
      gap: var(--gap);
      margin-bottom: 16px;
    }

    .content pre {
      padding: 14px;
    }

    .content h2 {
      margin-top: calc(1.5 * var(--gap));
      margin-bottom: 0;
    }

    .content h3,
    .content h4 {
      margin-top: calc(1.2 * var(--gap));
      margin-bottom: 0;
    }

    .content figcaption {
      font-style: italic;
      font-size: 14px;
    }

    .content ul {
      padding-left: 40px;
      list-style: disc;
    }

    .content blockquote {
      padding-left: 16px;
      font-style: italic;
    }

    .hero {
      width: 100%;
    }

    .not-hero-link {
      position: relative;
      display: block;
    }

    .not-hero-link::before,
    .not-hero-link::after {
      content: '';
      position: absolute;
      width: 18px;
      height: 200px;
      background-color: #fcfae3;
      z-index: 1;
    }

    .not-hero-link::before {
      left: 20%;
      top: 59px;
      transform: rotate(-49deg);
      border-top-right-radius: 20px;
    }

    .not-hero-link::after {
      left: 20%;
      top: -59px;
      transform: rotate(49deg);
      border-bottom-right-radius: 20px;
    }

    .not-hero {
      max-height: 200px;
      object-fit: cover;
      object-position: 0 88%;
      clip-path: polygon(15% 0%, 100% 0%, 100% 100%, 15% 100%, 0% 50%);
    }

    @media (max-width: 600px) {
      .hero {
        height: 533px;
        object-fit: cover;
        object-position: center;
      }

      .not-hero-link::before,
      .not-hero-link::after {
          display: none;
      }
    }
  </style>

  <script is:inline>
    if (window.navigator && navigator.serviceWorker) {
      navigator.serviceWorker.getRegistrations().then(function (registrations) {
        for (let registration of registrations) {
          registration.unregister();
        }
      });
    }
  </script>
</html>
