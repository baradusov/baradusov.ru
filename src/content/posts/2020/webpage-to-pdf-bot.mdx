---
title: 'Телеграм-бот для создания пдфок'
created: '2020-07-20'
draft: false
---

[Телеграм-бот](https://t.me/html_to_pdf_bot), который поможет сохранить статью как pdf-файл. Кидаешь ссылку — получаешь читабельную пдфку.

![](/img/c3c5681e83b0db01d4f0ca842500d343f88023e00ebc90a7ccf2092aeea7fd97.jpg)

## Идея

Как обычно бывает, я просто хотел решить свою проблему, но не нашёл подходящего готового инструмента.

До пандемии я часто ездил в родную деревню, где нет интернета и очень плохо ловит сотовая связь. После того, как вскопаешь огород, почистишь навоз и поставишь чёртовых гусей на место, хочется сесть на крылечко, налить парного молока и почитать статью [Пола Грэма](http://www.paulgraham.com/vb.html), которая ждёт тебя в очереди вкладок в браузере. И тут-то моя проблема и возникает. В какой-то момент мне надоело бегать по огороду, ловя связь с поднятой рукой, и решил я сделать [бота](https://t.me/html_to_pdf_bot).

Главное требование для бота — простота. Кинул ссылку — получил пдф. Без каких-либо команд и прочего.

## Делаем

Прототип был сделан за несколько вечеров. Большая часть времени была потрачена на выбор феймворка и дома для бота. Я хотел обойтись без базы данных и чтобы бот работал на лямбде с помощью вебхуков. Прототип делал то, что хотел — генерировал пдф из ссылки. Дальше надо было заставить его делать читабельную пдф, то есть оставлять только текст и изображения.

В качестве сервера я выбрал [Vercel](https://vercel.com/) (Zeit), потому что бесплатно, удобно и есть серверлесс функции. Подключил GitHub — автоматически получил CI.
Сам бот сделан с помощью [Telegraf.js](https://telegraf.js.org), потому что первая ссылка в гугле.
В читабельный вид статью приводит[ библиотека, которая отвечает за режим чтения](https://github.com/mozilla/readability) в Firefox. А сама пдф сохраняется с помощью [Chrome](https://github.com/alixaxel/chrome-aws-lambda).

В итоге бот делал всё как я хотел. Накидал ссылок, получил пдфки, сохранил на смартфон и поехал в деревню пасти гусей.

Единственная оставшаяся проблема — он не могёт в тяжёлые статьи, потому что у Vercel ограничения в 10 секунд на исполнение функций.

## Индийцы

Всё было хорошо, пока не пришли они.

![](/img/e1d27b560ab8de7463f3c1746ce366a1240933b0aa129064d03307d63162acf2.jpg)
![](/img/cbd1c6b047c5b2a54ca29fbdd5d51ae955f662d6ade23ab95856f34f9d11a005.jpg)
![](/img/341e40bfe5be463ee5f27707b1866b341d7c79c4e572c51d9b29e3456e5055f7.jpg)
![](/img/ea6dc2adfb2080fee68f142036ccb9a9dd3cd7148cdb9f71cbc7369ce32e64d9.jpg)
![](/img/1c988b9b56f39a5ddf1b27633ca5be2db522e12ddeae8cbb5dd6fc7b72a002ed.jpg)

Мне начали писать в личку и просить добавить поддержку хинди и телугу, и ещё расширить функционал.

Шрифты я с радостью добавил. Но менять и расширяться не стал. Бот делает одну вещь и делает хорошо. Индийцы, извините.

После этого я добавил простое логирование, и в течение недели записывал ссылки в Airtable, чтобы понять как используют бота.

Большинство ссылок было на индийских языках связанных с учёбой и образованием.
Некоторые хитрили и сохраняли твиттер-треды с threadreaderapp.com. Изредка встречались ссылки на испанские эротические рассказы. Сейчас логирую только удачные и неудачные попытки получить пдф.

Бот работает около трёх месяцев. В среднем каждый день генерирует около десяти пдф от 8-10 уникальных пользователей.

## Траты и планы

На разработку бота ничего не потратил. Это проект больше для себя, чтобы научиться чему-то новому, не верстать же всю жизнь.

В будущем хотелось бы научить бота обрабатывать несколько ссылок из одного сообщения. И если хватит фана, то сделать веб-морду с удобным списком пдфок и ссылками для скачивания.

Монетизировать бота не было в планах. Не представляю, как можно это делать с таким специфичным ботом. Личная веб-морда по подписке?

Но индийскую любовь я уже заслужил.

![](/img/cc59c325a485676aab48235656699425abbe5911afcaaf2c0a551eb94bbf69dc.jpg)

_Изначально статья была [написана для Вастрик.Клуба](https://vas3k.club/project/3984/)_
